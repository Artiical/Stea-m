{% extends 'base.html.twig' %}

{% block title %}{{ game.title }}{% endblock %}

{% block body %}
    <div class="game-detail-container">
        {# Section hero principale #}
        <div class="game-hero">
            <div class="container">
                <div class="game-hero-content">
                    <div class="game-media">
                        {% if game.image %}
                            <img src="{{ game.image }}" alt="{{ game.title }}" class="game-hero-image">
                        {% else %}
                            <div class="game-hero-placeholder">‚¨¢</div>
                        {% endif %}
                        
                        {% if game.trailerUrl %}
                            <div class="game-trailer">
                                <iframe src="{{ game.trailerUrl }}" frameborder="0" allowfullscreen></iframe>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="game-info">
                        <h1 class="game-title">{{ game.title }}</h1>
                        
                        <div class="game-meta">
                            {% if game.averageRating %}
                                <div class="game-rating">
                                    <span class="rating-stars">
                                        {% for i in 1..5 %}
                                            {% if i <= game.averageRating %}
                                                ‚≠ê
                                            {% else %}
                                                ‚òÜ
                                            {% endif %}
                                        {% endfor %}
                                    </span>
                                    <span class="rating-text">{{ game.averageRating|number_format(1) }}/5</span>
                                </div>
                            {% endif %}
                            
                            <div class="game-tags">
                                {% if game.genre %}
                                    <span class="tag genre-tag">{{ game.genre }}</span>
                                {% endif %}
                                {% if game.platform %}
                                    <span class="tag platform-tag">{{ game.platform }}</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="game-description">
                            <p>{{ game.description }}</p>
                        </div>

                        <div class="game-details">
                            {% if game.developer %}
                                <div class="detail-item">
                                    <span class="detail-label">D√©veloppeur:</span>
                                    <span class="detail-value">{{ game.developer }}</span>
                                </div>
                            {% endif %}
                            
                            {% if game.publisher %}
                                <div class="detail-item">
                                    <span class="detail-label">√âditeur:</span>
                                    <span class="detail-value">{{ game.publisher }}</span>
                                </div>
                            {% endif %}
                            
                            {% if game.releaseDate %}
                                <div class="detail-item">
                                    <span class="detail-label">Date de sortie:</span>
                                    <span class="detail-value">{{ game.releaseDate|date('d/m/Y') }}</span>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="game-actions">
                        <div class="price-section">
                            {% if game.price > 0 %}
                                <div class="price-display">
                                    <span class="price-amount">{{ game.price|number_format(2) }}‚Ç¨</span>
                                </div>
                            {% else %}
                                <div class="price-display free">
                                    <span class="price-amount">Gratuit</span>
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="action-buttons">
                            <a href="{{ path('cart_add', {'id': game.id}) }}" class="btn btn-primary btn-large">
                                <span class="icon">üõí</span>
                                <span>Ajouter au panier</span>
                            </a>
                            
                            <button class="btn btn-secondary btn-large wishlist-btn">
                                <span class="icon">‚ù§Ô∏è</span>
                                <span>Ajouter √† la wishlist</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {# Section contenu d√©taill√© #}
        <div class="game-content">
            <div class="container">
                <div class="content-tabs">
                    <div class="tab-navigation">
                        <button class="tab-btn active" data-tab="overview">Vue d'ensemble</button>
                        {% if game.systemRequirements %}
                            <button class="tab-btn" data-tab="requirements">Configuration</button>
                        {% endif %}
                    </div>

                    <div class="tab-content">
                        <div class="tab-panel active" id="overview">
                            {% if game.longDescription %}
                                <div class="long-description">
                                    <h3>√Ä propos de ce jeu</h3>
                                    <p>{{ game.longDescription|nl2br }}</p>
                                </div>
                            {% endif %}
                        </div>

                        {% if game.systemRequirements %}
                            <div class="tab-panel" id="requirements">
                                <div class="system-requirements">
                                    <h3>Configuration syst√®me requise minimale</h3>
                                    <div class="requirements-grid">
                                        {% for key, value in game.systemRequirements %}
                                            <div class="requirement-item">
                                                <span class="req-label">{{ key }}:</span>
                                                <span class="req-value">{{ value }}</span>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        {# Section jeux similaires #}
        {% if similarGames|length > 0 %}
            <div class="similar-games">
                <div class="container">
                    <h3>Jeux similaires dans le genre {{ game.genre }}</h3>
                    <div class="similar-games-container">
                        <div class="similar-games-grid">
                            {% for similarGame in similarGames %}
                                <div class="similar-game-item">
                                    <a href="{{ path('game_show', {'id': similarGame.id}) }}">
                                        <div class="similar-game-image-container"{% if similarGame.image %} style="--bg-image: url('{{ similarGame.image }}')"{% endif %}>
                                            {% if similarGame.image %}
                                                <img src="{{ similarGame.image }}" alt="{{ similarGame.title }}" class="similar-game-image">
                                            {% else %}
                                                <div class="similar-game-placeholder">‚¨¢</div>
                                            {% endif %}
                                        </div>
                                        <div class="similar-game-content">
                                            <h4>{{ similarGame.title }}</h4>
                                            {% if similarGame.price > 0 %}
                                                <p class="similar-game-price">{{ similarGame.price|number_format(2) }}‚Ç¨</p>
                                            {% else %}
                                                <p class="similar-game-price free">Gratuit</p>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        // Utiliser event delegation pour √©viter les probl√®mes de navigation
        document.addEventListener('click', function(e) {
            // V√©rifier si l'√©l√©ment cliqu√© est un bouton d'onglet
            if (e.target.classList.contains('tab-btn')) {
                e.preventDefault();
                
                const targetTab = e.target.getAttribute('data-tab');
                const tabButtons = document.querySelectorAll('.tab-btn');
                const tabPanels = document.querySelectorAll('.tab-panel');
                
                // Retirer la classe active de tous les boutons et panneaux
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabPanels.forEach(panel => panel.classList.remove('active'));
                
                // Ajouter la classe active au bouton cliqu√©
                e.target.classList.add('active');
                
                // Afficher le panneau correspondant
                const targetPanel = document.getElementById(targetTab);
                if (targetPanel) {
                    targetPanel.classList.add('active');
                }
            }
        });
    </script>
{% endblock %}
